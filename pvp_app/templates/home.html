{% extends 'base.html' %}
{% block content %}
  {% if pokemon %}
  <!-- redirect to results part of page -->
  <script>
    window.location.href = '#results-link';
  </script>
  {% endif %}
  <h2 id="welcome-link">welcome</h2>
  <a href="#results-link">Results</a>
  <p>
    <form action="{% url 'home' %}">
      <button type="submit" class="reset btn btn-warning">Reset</button>
    </form>
  </p>
    <form method="POST" action="{% url 'analyze' %}">
      {% csrf_token %}


      <label for="pokemon">Pokemon</label>
      <input type="text" id="pokemon" name="pokemon" autofocus required value="{{ pokemon }}">

      <label for="evo_pokemon">Evolution</label>
      <input type="text" id="evo_pokemon" name="evo_pokemon" required value="{{ evolution }}">
      
      <div class="IVInputsContainer">
      {% if pokemon %}
        {% for result in results %}
        <div class="IVs">
          {% if not result.inputs.is_valid %}
          <div class="invalidCombo">
            <h3>Wrong CP & IV combination</h3>
          </div>
          {% endif %}
          <button type="button" class="delete btn btn-danger" tabindex="-1" >-</button>
          <label for="cp">CP</label>
          <input type="number" id="cp" name="cp" value="{{ result.inputs.cp }}">
          
          <label for="attack">Attack IV</label>
          <input type="number" id="attack" name="attack" value="{{ result.inputs.attack }}">
          
          <label for="defense">Defense IV</label>
          <input type="number" id="defense" name="defense" value="{{ result.inputs.defense }}">

          <label for="stamina">Stamina IV</label>
          <input type="number" id="stamina" name="stamina" value="{{ result.inputs.stamina }}">
        </div>
        {% endfor %}
      {% else %}
        <div class="IVs">
          <!-- delete button that's disabled for first row -->
          <button type="button" class="delete btn btn-danger" tabindex="-1" disabled>-</button>
          <label for="cp">CP</label>
          <input type="number" id="cp" name="cp">

          <label for="attack">Attack IV</label>
          <input type="number" id="attack" name="attack" >
          
          <label for="defense">Defense IV</label>
          <input type="number" id="defense" name="defense" >

          <label for="stamina">Stamina IV</label>
          <input type="number" id="stamina" name="stamina" >
        </div>
      {% endif %}
      </div>

      <div class="league_choices">
        <label for="GL">Great League</label>
        <input type="checkbox" name="GL" id="GL" value="true">

        <label for="UL">Ultra League</label>
        <input type="checkbox" name="UL" id="UL" value="true">

        <label for="ML">Master League</label>
        <input type="checkbox" name="ML" id="ML" value="true">
      </div>

      <button type="button" class="btn btn-info" id="add">Add</button>
      <button type="submit" class="btn btn-success analyze">Analyze</button>


    </form>
  <div id="results-link">
    <h3 >results</h3>
    {% if pokemon %}
      <h4>{{ pokemon }} --> {{ evolution }}</h4>
      {% for result in results %}
        <p>
          CP: {{ result.inputs.cp }} Attack: {{ result.inputs.attack }}, Defense: {{ result.inputs.defense }}, Stamina: {{ result.inputs.stamina }}
        </p>
        {% if not result.inputs.is_valid %}
          <h4>Invalid CP & IV Combo</h4>
        {% else %}
          {% if analyze_GL %}
          {{analyze_GL}}
            <p>
              GL rank: {{ result.stats.GL.rank }}
            </p>
            <p>
              stat product: {{ result.stats.GL.stat_product }}
            </p>
            <p>% of Max: {{ result.stats.GL.percent_of_max }}</p>
            <p>cp 1500: {{ result.power_up.GL.cp_1500  }}</p>
            <p>power ups: {{ result.power_up.GL.power_up_count }}</p>
            <br/>
          {% endif %}
          {% if analyze_UL %}
          {{analyze_UL}}
            <p>
              UL rank: {{ result.stats.UL.rank }}
            </p>
            <p>
              stat product: {{ result.stats.UL.stat_product }}
            </p>
            <p>
              cp 2500: {{ result.power_up.UL.cp_2500}}
            </p>

          {% endif %}
          {% if analyze_ML %}
          {{analyze_ML}}
            <p>
              ML rank: {{ result.stats.ML.rank }}
            </p>
            <p>
              max cp: {{ result.power_up.ML.cp_max }}
            </p>
          {% endif %}
        {% endif %}
      {% endfor %}
    {% endif %}
  </div>
  <a href="#welcome-link">Back to Top</a>

{% endblock %}